'<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œê°ì¥ì• ì¸ì„ ìœ„í•œ ë„ë¡œ ì•ˆë‚´ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1>ì‹œê°ì¥ì• ì¸ì„ ìœ„í•œ ë„ë¡œ ì•ˆë‚´ ì‹œìŠ¤í…œ</h1>
        
        <!-- ì•ˆë‚´ ë©”ì‹œì§€ ì˜ì—­ -->
        <div id="instruction-box" class="instruction">
            <p id="instruction-text">ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•˜ì„¸ìš”</p>
        </div>
        
        <!-- ë°©í–¥ ì •ë³´ í‘œì‹œ ì˜ì—­ -->
        <div id="direction-display" class="direction-display">
            <div class="direction-content">
                <h3>ğŸ§­ ì´ë™ ê°€ëŠ¥í•œ ë°©í–¥</h3>
                <div id="direction-list" class="direction-list">
                    <!-- ë°©í–¥ ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
        
        <div class="video-container">
            <!-- ì‹¤ì‹œê°„ ì¹´ë©”ë¼ ì˜ì—­ -->
            <div class="video-wrapper camera-wrapper">
                <h2>ì‹¤ì‹œê°„ ì¹´ë©”ë¼</h2>
                <div class="camera-container">
                    <video id="webcam" autoplay playsinline muted></video>
                    <!-- ì˜¤ë²„ë ˆì´ ìº”ë²„ìŠ¤ëŠ” JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
                <div class="button-container">
                    <button id="start-camera">ì¹´ë©”ë¼ ì‹œì‘</button>
                    <button id="toggle-grayscale" class="grayscale-toggle">í‘ë°± ëª¨ë“œ</button>
                </div>
            </div>
            
            <!-- ê²°ê³¼ ì´ë¯¸ì§€ëŠ” ìˆ¨ê¹€ ì²˜ë¦¬ (ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ) -->
            <img id="result" src="" style="display: none;">
        </div>
        
        <div class="status">
            <p id="status-text">ì„œë²„ì— ì—°ê²° ì¤‘...</p>
        </div>
        
        <!-- ë„¤ë¹„ê²Œì´ì…˜ ì •ë³´ í‘œì‹œ -->
        <div id="navigation-info" class="navigation-info">
            <div class="nav-item">
                <strong>ìƒíƒœ:</strong> <span id="nav-state">ì•Œ ìˆ˜ ì—†ìŒ</span>
            </div>
            <div class="nav-item">
                <strong>ë°©í–¥:</strong> <span id="nav-direction">ì—†ìŒ</span>
            </div>
            <div class="nav-item">
                <strong>ìŒí–¥ì‹ í˜¸ê¸°:</strong> <span id="nav-button">ì—†ìŒ</span>
            </div>
            <div class="nav-item">
                <strong>ì¥ì• ë¬¼:</strong> <span id="nav-obstacles">ì—†ìŒ</span>
            </div>
        </div>
        
        <!-- ê²½ê³  ë©”ì‹œì§€ ì˜ì—­ -->
        <div id="warning-box" class="warning-box hidden">
            <div class="warning-content">
                <h3>âš ï¸ ê²½ê³ </h3>
                <ul id="warning-list"></ul>
            </div>
        </div>
        
        <!-- ë””ë²„ê¹… ì •ë³´ ì˜ì—­ -->
        <div id="debug-info" class="debug-info">
            <details>
                <summary>ë””ë²„ê¹… ì •ë³´</summary>
                <div id="debug-content">
                    <p>ê°ì§€ëœ í´ë˜ìŠ¤: <span id="debug-classes">ì—†ìŒ</span></p>
                    <p>ê°ì§€ëœ ë°•ìŠ¤ ìˆ˜: <span id="debug-boxes">0</span></p>
                    <p>ì´ë¯¸ì§€ ëª¨ë“œ: <span id="debug-mode">ì»¬ëŸ¬</span></p>
                    <p>ì²˜ë¦¬ ìƒíƒœ: <span id="debug-status">ëŒ€ê¸°ì¤‘</span></p>
                </div>
            </details>
        </div>
    </div>
    <script>

  
        document.getElementById('start-camera').addEventListener('click', () => {
            speak("ì•ˆë…•")
});
const socket = io();

let lastSpokenMessage = "";

socket.on('connect', () => {
    document.getElementById("status-text").textContent = "ì„œë²„ì— ì—°ê²°ë¨";
    
});

socket.on('result', function(data) {
    // ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
    const resultImage = document.getElementById('result');
    resultImage.src = data.image;

    // ë„¤ë¹„ê²Œì´ì…˜ ì •ë³´ ì¶œë ¥
    const nav = data.navigation || {};
    document.getElementById('nav-state').textContent = nav.state || 'ì—†ìŒ';
    document.getElementById('nav-direction').textContent = nav.direction || 'ì—†ìŒ';
    document.getElementById('nav-button').textContent = nav.button || 'ì—†ìŒ';
    document.getElementById('nav-obstacles').textContent = nav.obstacles || 'ì—†ìŒ';

    // ë””ë²„ê¹… ì •ë³´ ì—…ë°ì´íŠ¸
    document.getElementById('debug-classes').textContent = data.classes.join(', ') || 'ì—†ìŒ';
    document.getElementById('debug-boxes').textContent = data.boxes.length || 0;
    document.getElementById('debug-mode').textContent = data.grayscale_mode ? 'í‘ë°±' : 'ì»¬ëŸ¬';
    document.getElementById('debug-status').textContent = 'ì™„ë£Œ';

    // TTS ì•ˆë‚´ë¬¸ ìƒì„± ë° ìŒì„± ì¬ìƒ
    
});

// ì˜ë¯¸ ìˆëŠ” ì•ˆë‚´ ë¬¸ì¥ êµ¬ì„±
function generateContextualMessage(nav) {
    let parts = [];
    speechSynthesis.resume(); // ìŒì„± ì˜ˆì—´
    const testUtterance = new SpeechSynthesisUtterance("ì•ˆì‹œ");
    testUtterance.lang = 'ko-KR';
    speechSynthesis.speak(testUtterance);}</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>